<script>
  const contractAddress = "0x7b4a134387ff518cb14f520b3b8d7e7d38685e83";

  const abi = [
    {
      "anonymous": false,
      "inputs": [
        { "indexed": true, "internalType": "uint256", "name": "id", "type": "uint256" },
        { "indexed": true, "internalType": "address", "name": "owner", "type": "address" },
        { "indexed": false, "internalType": "string", "name": "location", "type": "string" },
        { "indexed": false, "internalType": "uint256", "name": "area", "type": "uint256" }
      ],
      "name": "LandRegistered",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        { "indexed": true, "internalType": "uint256", "name": "id", "type": "uint256" },
        { "indexed": true, "internalType": "address", "name": "oldOwner", "type": "address" },
        { "indexed": true, "internalType": "address", "name": "newOwner", "type": "address" }
      ],
      "name": "LandTransferred",
      "type": "event"
    },
    {
      "inputs": [
        { "internalType": "uint256", "name": "_id", "type": "uint256" },
        { "internalType": "string", "name": "_location", "type": "string" },
        { "internalType": "uint256", "name": "_area", "type": "uint256" }
      ],
      "name": "registerLand",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        { "internalType": "uint256", "name": "_id", "type": "uint256" },
        { "internalType": "address", "name": "_newOwner", "type": "address" }
      ],
      "name": "transferLand",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        { "internalType": "uint256", "name": "_id", "type": "uint256" }
      ],
      "name": "getLand",
      "outputs": [
        { "internalType": "uint256", "name": "", "type": "uint256" },
        { "internalType": "string", "name": "", "type": "string" },
        { "internalType": "uint256", "name": "", "type": "uint256" },
        { "internalType": "address", "name": "", "type": "address" }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        { "internalType": "uint256", "name": "", "type": "uint256" }
      ],
      "name": "lands",
      "outputs": [
        { "internalType": "uint256", "name": "id", "type": "uint256" },
        { "internalType": "string", "name": "location", "type": "string" },
        { "internalType": "uint256", "name": "area", "type": "uint256" },
        { "internalType": "address", "name": "owner", "type": "address" },
        { "internalType": "bool", "name": "exists", "type": "bool" }
      ],
      "stateMutability": "view",
      "type": "function"
    }
  ];

  let provider, signer, contract;

  async function connect() {
    console.log("üîÑ Attempting to connect to MetaMask...");
    if (typeof window.ethereum !== 'undefined') {
      try {
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        provider = new ethers.BrowserProvider(window.ethereum);
        signer = await provider.getSigner();
        const address = await signer.getAddress();
        console.log("üü¢ Connected wallet:", address);
        contract = new ethers.Contract(contractAddress, abi, signer);
        console.log("üìÑ Contract initialized:", contract);
        document.getElementById("walletStatus").innerText = "üü¢ Connected to MetaMask";
      } catch (err) {
        console.error("‚ùå Connection error:", err);
        document.getElementById("walletStatus").innerText = "üî¥ Connection failed.";
      }
    } else {
      alert("‚ùå MetaMask is not installed.");
      document.getElementById("walletStatus").innerText = "üî¥ MetaMask not found.";
    }
  }

  connect();

  async function registerLand() {
    const id = document.getElementById("regId").value;
    const location = document.getElementById("regLocation").value;
    const area = document.getElementById("regArea").value;

    try {
      const tx = await contract.registerLand(id, location, area);
      await tx.wait();
      document.getElementById("output").innerText = `‚úÖ Land Registered!\nTx Hash: ${tx.hash}`;
    } catch (err) {
      document.getElementById("output").innerText = `‚ùå Error: ${err.message}`;
    }
  }

  async function transferLand() {
    const id = document.getElementById("transId").value;
    const newOwner = document.getElementById("newOwner").value;

    try {
      const tx = await contract.transferLand(id, newOwner);
      await tx.wait();
      document.getElementById("output").innerText = `‚úÖ Land Transferred!\nTx Hash: ${tx.hash}`;
    } catch (err) {
      document.getElementById("output").innerText = `‚ùå Error: ${err.message}`;
    }
  }

  async function getLand() {
    const id = document.getElementById("getId").value;

    try {
      const land = await contract.getLand(id);
      document.getElementById("output").innerText = `
üåç Land Info:
‚Ä¢ ID: ${land[0]}
‚Ä¢ Location: ${land[1]}
‚Ä¢ Area: ${land[2]} sq ft
‚Ä¢ Owner: ${land[3]}
      `;
    } catch (err) {
      document.getElementById("output").innerText = `‚ùå Error: ${err.message}`;
    }
  }
</script>
