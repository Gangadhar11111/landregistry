<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Land Registry System</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.umd.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(145deg, #0f0f1a, #1a0f2d);
      color: #eae6ff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      backdrop-filter: blur(10px);
      background: rgba(30, 15, 50, 0.4);
      border: 1px solid rgba(200, 100, 255, 0.2);
      border-radius: 20px;
      padding: 2rem;
      max-width: 720px;
      width: 100%;
      box-shadow: 0 0 30px rgba(150, 100, 255, 0.3);
    }

    h1 {
      text-align: center;
      color: #c77dff;
      font-size: 2.5rem;
      margin-bottom: 2rem;
      letter-spacing: 1px;
    }

    h3 {
      color: #ffffff;
      font-size: 1.2rem;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
      border-left: 4px solid #c77dff;
      padding-left: 10px;
    }

    input {
      background: rgba(40, 20, 60, 0.6);
      border: 1px solid #c77dff;
      border-radius: 10px;
      padding: 12px;
      font-size: 1rem;
      margin: 0.4rem 0;
      color: #fff;
      width: 100%;
    }

    input:focus {
      outline: none;
      border-color: #ff8af4;
      box-shadow: 0 0 8px rgba(255, 138, 244, 0.4);
    }

    button {
      background: linear-gradient(to right, #7209b7, #b5179e);
      border: none;
      color: white;
      padding: 12px;
      margin-top: 0.8rem;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      transition: 0.3s ease-in-out;
    }

    button:hover {
      background: linear-gradient(to right, #560bad, #a4139c);
      box-shadow: 0 0 15px rgba(200, 100, 255, 0.4);
    }

    .output {
      background: rgba(20, 10, 40, 0.6);
      border-left: 4px solid #c77dff;
      padding: 1rem;
      margin-top: 1.5rem;
      border-radius: 10px;
      font-family: monospace;
      color: #d1eaff;
      white-space: pre-wrap;
    }

    #walletStatus {
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
      color: #f0aaff;
    }

    .section {
      margin-bottom: 2rem;
    }

    #totalCost {
      margin-top: 5px;
      color: #ffb3ff;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîÆ Land Registry System</h1>
    <div id="walletStatus">üïê Connecting to MetaMask...</div>

    <div class="section">
      <h3>Register New Land</h3>
      <input id="regId" placeholder="Land ID" type="number" />
      <input id="regLocation" placeholder="Location (e.g. City, State)" />
      <input id="regArea" placeholder="Area in sq ft" type="number" oninput="calculateCost()" />
      <div id="totalCost">üí∞ Total Cost: ‚Çπ0</div>
      <button onclick="registerLand()">Register Land</button>
    </div>

    <div class="section">
      <h3>Transfer Ownership</h3>
      <input id="transId" placeholder="Land ID to Transfer" type="number" />
      <input id="newOwner" placeholder="New Owner's Wallet Address" />
      <button onclick="transferLand()">Transfer Land</button>
    </div>

    <div class="section">
      <h3>Get Land Information</h3>
      <input id="getId" placeholder="Enter Land ID" type="number" />
      <button onclick="getLand()">Fetch Land Info</button>
    </div>

    <div class="output" id="output">üìÑ Output will appear here...</div>
  </div>

  <script>
    const contractAddress = "0x7b4a134387ff518cb14f520b3b8d7e7d38685e83";
    const RATE_PER_SQFT = 500;

    const abi = [
      {
        "anonymous": false,
        "inputs": [
          { "indexed": true, "internalType": "uint256", "name": "id", "type": "uint256" },
          { "indexed": true, "internalType": "address", "name": "owner", "type": "address" },
          { "indexed": false, "internalType": "string", "name": "location", "type": "string" },
          { "indexed": false, "internalType": "uint256", "name": "area", "type": "uint256" }
        ],
        "name": "LandRegistered",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          { "indexed": true, "internalType": "uint256", "name": "id", "type": "uint256" },
          { "indexed": true, "internalType": "address", "name": "oldOwner", "type": "address" },
          { "indexed": true, "internalType": "address", "name": "newOwner", "type": "address" }
        ],
        "name": "LandTransferred",
        "type": "event"
      },
      {
        "inputs": [
          { "internalType": "uint256", "name": "_id", "type": "uint256" },
          { "internalType": "string", "name": "_location", "type": "string" },
          { "internalType": "uint256", "name": "_area", "type": "uint256" }
        ],
        "name": "registerLand",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "uint256", "name": "_id", "type": "uint256" },
          { "internalType": "address", "name": "_newOwner", "type": "address" }
        ],
        "name": "transferLand",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "uint256", "name": "_id", "type": "uint256" }
        ],
        "name": "getLand",
        "outputs": [
          { "internalType": "uint256", "name": "", "type": "uint256" },
          { "internalType": "string", "name": "", "type": "string" },
          { "internalType": "uint256", "name": "", "type": "uint256" },
          { "internalType": "address", "name": "", "type": "address" }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    let provider, signer, contract;

    async function connect() {
      if (typeof window.ethereum !== 'undefined') {
        try {
          await window.ethereum.request({ method: 'eth_requestAccounts' });
          provider = new ethers.BrowserProvider(window.ethereum);
          signer = await provider.getSigner();
          contract = new ethers.Contract(contractAddress, abi, signer);
          document.getElementById("walletStatus").innerText = "üü£ Connected to MetaMask";
        } catch (err) {
          document.getElementById("walletStatus").innerText = "üî¥ Connection failed.";
        }
      } else {
        alert("‚ùå MetaMask is not installed.");
        document.getElementById("walletStatus").innerText = "üî¥ MetaMask not found.";
      }
    }

    connect();

    function calculateCost() {
      const area = document.getElementById("regArea").value;
      const totalCost = area * RATE_PER_SQFT;
      document.getElementById("totalCost").innerText = `üí∞ Total Cost: ‚Çπ${totalCost || 0}`;
    }

    async function registerLand() {
      const id = document.getElementById("regId").value;
      const location = document.getElementById("regLocation").value;
      const area = document.getElementById("regArea").value;
      const totalCost = area * RATE_PER_SQFT;

      if (!id || !location || !area) {
        document.getElementById("output").innerText = "‚ùó Please fill all fields.";
        return;
      }

      try {
        const tx = await contract.registerLand(id, location, area);
        await tx.wait();
        document.getElementById("output").innerText = `‚úÖ Land Registered!\nTotal Cost: ‚Çπ${totalCost}\nTx Hash: ${tx.hash}`;
      } catch (err) {
        document.getElementById("output").innerText = `‚ùå Error: ${err.message}`;
      }
    }

    async function transferLand() {
      const id = document.getElementById("transId").value;
      const newOwner = document.getElementById("newOwner").value;

      try {
        const tx = await contract.transferLand(id, newOwner);
        await tx.wait();
        document.getElementById("output").innerText = `‚úÖ Land Transferred!\nTx Hash: ${tx.hash}`;
      } catch (err) {
        document.getElementById("output").innerText = `‚ùå Error: ${err.message}`;
      }
    }

    async function getLand() {
      const id = document.getElementById("getId").value;

      try {
        const land = await contract.getLand(id);
        document.getElementById("output").innerText = `
üåç Land Info:
‚Ä¢ ID: ${land[0]}
‚Ä¢ Location: ${land[1]}
‚Ä¢ Area: ${land[2]} sq ft
‚Ä¢ Owner: ${land[3]}
        `;
      } catch (err) {
        document.getElementById("output").innerText = `‚ùå Error: ${err.message}`;
      }
    }
  </script>
</body>
</html>
